<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include ('partials/_favicons') %>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <style>
      /* Tooltip container */
      .tooltip {
        position: relative;
        display: inline-block;
        border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
      }
      
      /* Tooltip text */
      .tooltip .tooltiptext {
        visibility: hidden;
        width: 120px;
        background-color: black;
        color: #fff;
        text-align: center;
        padding: 5px 0;
        border-radius: 6px;

        /* Position the tooltip text - see examples below! */
        position: absolute;
        z-index: 1;
      }
      
      /* Show the tooltip text when you mouse over the tooltip container */
      .tooltip:hover .tooltiptext {
        visibility: visible;
      }
      </style>
<!-- CHARTING -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>

    <title>TinyApp! - Tiny URL listings</title>
  </head>

  <body>
    <%- include ('partials/_header') %>
    <div class="card text-left">
      <div class="card-header"></div>
      <div class="card-body">
        <h4 class="card-title">URL Info:</h4>
        <h5 class="card-title">Original URL: <%= longURL %></h5>
        
          <% if(locals.message) { %>
            <br><p class="h6 text-danger"><%= message %></p>
          <% } %>
        <div class="card-body">
        <p class="card-text">
          Tiny URL ID: <a id="clipboard_tocopy" href="http://localhost:8080/u/<%= id %>">http://localhost:8080/u/<%= id %></a>&nbsp;&nbsp;<button class="btn btn-icon btn-sm btn-light" data-clipboard-target="#clipboard_tocopy">
            <!--begin::Svg Icon | path: icons/duotune/general/gen054.svg-->
            <span class="svg-icon svg-icon-2">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path opacity="0.5" d="M18 2H9C7.34315 2 6 3.34315 6 5H8C8 4.44772 8.44772 4 9 4H18C18.5523 4 19 4.44772 19 5V16C19 16.5523 18.5523 17 18 17V19C19.6569 19 21 17.6569 21 16V5C21 3.34315 19.6569 2 18 2Z" fill="currentColor" />
                <path fill-rule="evenodd" clip-rule="evenodd" d="M14.7857 7.125H6.21429C5.62255 7.125 5.14286 7.6007 5.14286 8.1875V18.8125C5.14286 19.3993 5.62255 19.875 6.21429 19.875H14.7857C15.3774 19.875 15.8571 19.3993 15.8571 18.8125V8.1875C15.8571 7.6007 15.3774 7.125 14.7857 7.125ZM6.21429 5C4.43908 5 3 6.42709 3 8.1875V18.8125C3 20.5729 4.43909 22 6.21429 22H14.7857C16.5609 22 18 20.5729 18 18.8125V8.1875C18 6.42709 16.5609 5 14.7857 5H6.21429Z" fill="currentColor" />
              </svg>
            </span>
            <!--end::Svg Icon-->
            </button>
        </p>
        </div>
      </div>
      <div class="card-footer text-left">
        <!-- EDIT FORM HERE -->
        <h4>Change Destination URL:</h4>
        <form class="form-inline" method="POST" action="/urls/<%= id %>/update"><label for="longURL">URL: </label><input
          class="form-control"
          type="text"
          name="longURL"
          value ="<%= longURL %>"
          style="width: 300; margin: 1em; text-align:left"/></input><button type="submit" class="btn btn-primary"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
          <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
        </svg> Update</button></form>
      </div>
      <div class="card-body"><p class="card-text">
        <!-- ANALYTICS SECTION -->
      <h4 class="card-title">Analytics:</h4>
      <% if(locals.totalCount) { %><p><h5>Click Through Totals: <%= totalCount %></h5></p><% } %>

      <h5 class="card-title">Clicks By Hour:</h5>
      <div id="hourlystats" style="height: 250px;"></div>

      <% if(locals.uniques) { %><p><h5>Unique User Click Throughs: <%= uniques %></h5></p><% } %>
      <% if(locals.moreStats) { %>
        <table>
        <tr><td style="padding-right:20px"><b>User:</b></td><td align=center style="padding-left:20px"><b>Clicks:</b></td></tr>
        <% for (let anid in moreStats) { %>
          <tr><td style="padding-right:20px"><%= anid %></td><td align=center style="padding-left:20px"><%= moreStats[anid].count %></td></tr>
        <% } %>
      </table>
      <% } %>

      <p><h3><BR>Click Through Log:</h3></p>
      <table>
        <tr><td style="padding-right:25px"><h5>Date & Time (UTC)</h5></td><td><h5>User ID of Who Clicked:</h5></td></tr>
      <% for (let id in logs) { %>
        <tr><td style="padding-right:25px"><%= logs[id].dateStamp %></td><td><%= logs[id].uid %>&nbsp;<%= logs[id].userType %></td></tr>
      <% } %>
      <tr><td colspan=2 align="right">
<!-- NOT YET ACTIVE - FUTURE USE ONLY-->
<nav aria-label="...">
  <ul class="pagination pagination-sm">
    <li class="page-item disabled">
      <span class="page-link">Previous</span>
    </li>
    <li class="page-item active"><a class="page-link" href="#">1</a></li>
    <li class="page-item"><a class="page-link" href="#">2</a></li>
    <li class="page-item disabled"><a class="page-link" href="#">3</a></li>
    <li class="page-item disabled">
      <a class="page-link" href="#">Next</a>
    </li>
  </ul>
</nav>
      </td></tr>
    </table>
    

    </p>
    </div>
    <!-- Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <%- include ('partials/_footer') %>
  </body>
<script>
  new Morris.Bar({
    // ID of the element in which to draw the chart.
    element: 'hourlystats',
    hideHover: true,
    resize: true,
    barColors: ['#2A8120'],
    // Chart data records -- each entry in this array corresponds to a point on
    // the chart.
    /*
  {hour: 07: value: 3},
     
      */

    data: [

    <% for (let id in graphStats) { %>
        { hour: <%= id %>, value:<%= graphStats[id] %> },
      <% } %>
     
    ],
    // The name of the data record attribute that contains x-values.
    xkey: 'hour',
    // A list of names of data record attributes that contain y-values.
    ykeys: ['value'],
    // Labels for the ykeys -- will be displayed when you hover over the
    // chart.
    labels: ['clicks this hour']
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
// Select elements
const target = document.getElementById('clipboard_tocopy');
const button = target.nextElementSibling;

// Init clipboard -- for more info, please read the offical documentation: https://clipboardjs.com/
clipboard = new ClipboardJS(button, {
    target: target,
    text: function () {
        return target.innerHTML;
    }
});

// Success action handler
clipboard.on('success', function (e) {
    var checkIcon = button.querySelector('.bi.bi-check');
    var svgIcon = button.querySelector('.svg-icon');

    // Exit check icon when already showing
    if (checkIcon) {
        return;
    }

    // Create check icon
    checkIcon = document.createElement('i');
    checkIcon.classList.add('bi');
    checkIcon.classList.add('bi-check');
    checkIcon.classList.add('fs-3x');
    checkIcon.classList.add('.text-success')
   
    // Append check icon
    button.appendChild(checkIcon);

    // Highlight target
    const classes = ['text-success', 'fw-boldest'];
    target.classList.add(...classes);

    // Highlight button
    button.classList.add('btn-success');

    // Hide copy icon
    svgIcon.classList.add('d-none');

    // Revert button label after 3 seconds
    setTimeout(function () {
        svgIcon.classList.remove('d-none'); // Remove check icon
        button.removeChild(checkIcon); // Revert icon
        
        target.classList.remove(...classes); // Remove target highlight
        button.classList.remove('btn-success'); // Remove button highlight
    }, 3000)
});
</script>
</html>